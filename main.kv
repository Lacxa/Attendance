#:import sm kivy.uix.screenmanager

FloatLayout:
    orientation: "vertical"

    # Screen Manager for switching between screens
    ScreenManager:
        id: screen_manager
        transition:sm.FadeTransition(duration=.0)
        # Home Screen
        MDScreen:
            name: "home"
            md_bg_color: [.17, .17, .17, .17]
            FloatLayout:
                orientation: "vertical"
                ScrollView:
                    pos_hint: {"center_x": .5, "center_y": .4}

                    MDBoxLayout:
                        orientation: "vertical"
                        spacing: dp(25)
                        padding: dp(25)
                        adaptive_height: True

                        MyAKBarChart:
                            id: chart3
                            labels: True
                            anim: True
                            x_labels: ["Second", "Third", "Last"]
                            y_labels: ["30", "40", "20"]
                            bars_color:[0, 0, 0.4, 1]
                            labels_color:[0, 0, 0.4, 1]
                            lines_color: [0, 0, 0.4, 1]
                            #on_select: root.set_text(args)

                MDLabel:
                    text: "112"
                    font_style: "H4"
                    halign: "left"
                    pos_hint:{"center_x":.55, "center_y":.95}
                MDLabel:
                    text: "Around 17 per Month"
                    halign: "right"
                    theme_text_color: "Secondary"
                    pos_hint:{"center_x":.44, "center_y":.95}
                MDLabel:
                    text: app.month_name
                    theme_text_color: "Secondary"
                    halign: "center"
                    pos_hint: {"center_x":.5, "center_y":.58}


                MDSeparator:
                    height: "2dp"
                    pos_hint:{"center_x":.5, "center_y":.5}

                BoxLayout:
                    orientation: "vertical"
                    padding: 30
                    spacing: 20
                    pos_hint:{"center_x":.5, "center_y":.6}


                    # Schools section
                    FloatLayout:
                        orientation: "vertical"
                        spacing: 10
                        size_hint_y: None
                        height: "60dp"
                        MDBoxLayout:
                            size_hint: None, None
                            size: "40dp", "40dp"
                            md_bg_color: app.theme_cls.primary_color[0:3] + [0.2]
                            radius: [10, 10, 10, 10]
                            pos_hint: {"center_x":.05, "center_y":.5}
                            padding: 5
                            MDIcon:
                                icon: "school"
                                size_hint: None, None
                                size: "24dp", "24dp"
                                halign: "center"
                                theme_text_color: "Custom"
                                text_color: 0, 0, 0, 1

                        MDLabel:
                            text: "Schools"
                            halign: "left"
                            pos_hint: {"center_x":.65, "center_y":.5}
                        MDLabel:
                            text: "45"
                            font_style: "Subtitle1"
                            halign: "center"
                            pos_hint: {"center_x":.7, "center_y":.5}


                    # Students section
                    FloatLayout:
                        orientation: "horizontal"
                        spacing: 10
                        size_hint_y: None
                        height: "60dp"

                        MDBoxLayout:
                            size_hint: None, None
                            size: "40dp", "40dp"
                            md_bg_color: app.theme_cls.primary_color[0:3] + [0.2]
                            radius: [10, 10, 10, 10]
                            pos_hint: {"center_x":.05, "center_y":.4}
                            padding: 5

                            MDIcon:
                                icon: "account-group"
                                size_hint: None, None
                                size: "24dp", "24dp"
                                halign: "center"
                                theme_text_color: "Custom"
                                text_color: 0, 0, 0, 1

                        MDLabel:
                            text: "Students"
                            halign: "left"
                            pos_hint: {"center_x":.65, "center_y":.4}

                        MDLabel:
                            text: "50"
                            font_style: "Subtitle1"
                            halign: "center"
                            pos_hint: {"center_x":.7, "center_y":.4}

                    FloatLayout:
                        orientation: "horizontal"
                        spacing: 10
                        size_hint_y: None
                        height: "60dp"

                        MDBoxLayout:
                            size_hint: None, None
                            size: "40dp", "40dp"
                            md_bg_color: app.theme_cls.primary_color[0:3] + [0.2]
                            radius: [10, 10, 10, 10]
                            pos_hint: {"center_x":.05, "center_y":.4}
                            padding: 5

                            MDIcon:
                                icon: "account"
                                size_hint: None, None
                                size: "24dp", "24dp"
                                halign: "center"
                                theme_text_color: "Custom"
                                text_color: 0, 0, 0, 1

                        MDLabel:
                            text: "Visitors"
                            halign: "left"
                            pos_hint: {"center_x":.65, "center_y":.4}

                        MDLabel:
                            text: "50"
                            font_style: "Subtitle1"
                            halign: "center"
                            pos_hint: {"center_x":.7, "center_y":.4}


                    MDSeparator:
                        height: "2dp"


        # Daily Attendance Screen
        MDScreen:
            name: "daily"
            md_bg_color: [.17, .17, .17, .17]
            FloatLayout:
                orientation: "vertical"
                MDRoundFlatButton:
                    text: "Open Date Picker"
                    pos_hint: {"center_x": .5, "center_y": .9}
                    on_release: app.show_date_picker()
                MDLabel:
                    id: date_label
                    theme_text_color: "Custom"
                    halign: "center"
                    pos_hint: {"center_x": .5, "center_y": .82}

                MDRoundFlatButton:
                    text: "permission"
                    pos_hint: {"center_x": .5, "center_y": .5}
                    on_release:
                        app.request_android_permissions()


                #InfoCard:
                RecycleView:
                    id: pvs
                    key_viewclass: 'viewclass'
                    key_size: 'height'
                    pos_hint:{"top":.75}
                    RecycleBoxLayout:
                        id:wa
                        spacing:dp(4)
                        padding: dp(10)
                        default_size: None, dp(80)
                        default_size_hint: 1, None
                        size_hint_y: None
                        height: self.minimum_height
                        orientation: 'vertical'

        MDScreen:
            name: "student"
            md_bg_color: [.17, .17, .17, .17]
            FloatLayout:
                orientation: "vertical"
                MDIconButton:
                    halign:"center"
                    icon:"chevron-left"
                    icon_size: "30sp"
                    pos_hint:{"center_x":.05, "center_y":.95}
                    on_release:
                        screen_manager.current = "daily"
                MDLabel:
                    text:"Students Attendance"
                    font_style: "H6"
                    halign: "center"
                    pos_hint: {"center_x": .5, "center_y": .95}

                MDIconButton:
                    halign:"center"
                    icon:"magnify"
                    font_size:"60sp"
                    pos_hint:{"center_x":.93, "center_y":.95}
                    on_release:
                        screen_manager.current = "search"
                #InfoCard:
                RecycleView:
                    id: prt
                    key_viewclass: 'viewclass'
                    key_size: 'height'
                    pos_hint:{"top":.92}
                    RecycleBoxLayout:
                        id:wa
                        spacing:dp(4)
                        padding: dp(10)
                        default_size: None, dp(50)
                        default_size_hint: 1, None
                        size_hint_y: None
                        height: self.minimum_height
                        orientation: 'vertical'


        MDScreen:
            name: "visitor"
            md_bg_color: [.17, .17, .17, .17]
            FloatLayout:
                orientation: "vertical"
                MDIconButton:
                    halign:"center"
                    icon:"chevron-left"
                    icon_size: "30sp"
                    pos_hint:{"center_x":.05, "center_y":.95}
                    on_release:
                        screen_manager.current = "daily"
                MDLabel:
                    text:"Visitors & school Attendance"
                    font_style: "H6"
                    halign: "center"
                    pos_hint: {"center_x": .5, "center_y": .95}

                MDIconButton:
                    halign:"center"
                    icon:"magnify"
                    font_size:"60sp"
                    pos_hint:{"center_x":.93, "center_y":.95}
                    on_release:
                        screen_manager.current = "search"
                #InfoCard:
                RecycleView:
                    id: vis
                    key_viewclass: 'viewclass'
                    key_size: 'height'
                    pos_hint:{"top":.92}
                    RecycleBoxLayout:
                        id:wa
                        spacing:dp(4)
                        padding: dp(10)
                        default_size: None, dp(50)
                        default_size_hint: 1, None
                        size_hint_y: None
                        height: self.minimum_height
                        orientation: 'vertical'


        # Report Screen
        MDScreen:
            name: "report"
            md_bg_color: [.17, .17, .17, .17]
            FloatLayout:
                orientation: "vertical"

                AsyncImage:
                    source:app.nodata
                    pos_hint:{'center_x':.7, 'center_y':.3}
                    size_hint: None, None
                    size: "350dp", "300dp"

                MDIcon:
                    icon: "calendar"
                    halign:"center"
                    font_size: "250sp"
                    theme_text_color: "Custom"
                    text_color: [0.2, 0.2, 0.2, 1]
                    pos_hint:{"center_x":.5, "center_y":.8}


                MDList:
                    adaptive_height: True
                    spacing: "20dp"
                    pos_hint:{"center_x":.5,"center_y":.45}
                    md_bg_color: [1, 1, 1, 0.5]

                    OneLineRightIconListItem:
                        text: "Weekly Report"

                        IconRightWidget:
                            icon: "chevron-right"
                            icon_size: "30sp"
                            on_release:
                                screen_manager.current = "share"

                    OneLineRightIconListItem:
                        text: "Monthly Report"

                        IconRightWidget:
                            icon: "chevron-right"
                            icon_size: "30sp"
                            on_release: print("Click!")

                    OneLineRightIconListItem:
                        text: "Year Report"
                        halign:"left"

                        IconRightWidget:
                            icon: "chevron-right"
                            icon_size: "30sp"
                            on_release: print("Click!")


        MDScreen:
            name: "!internet"
            md_bg_color: [.17, .17, .17, .17]

            FloatLayout:
                orientation: "vertical"
                MDLabel:
                    text: "No internet !"
                    halign: "center"
                    font_style:'H6'
                    theme_text_color: "Custom"
                    text_color: 1, 1, 1, 1
                    pos_hint:{"center_x":.5,"center_y":.92}

                Image:
                    source:app.internet
                    pos_hint:{"center_x":.5,"center_y":.5}

        MDScreen:
            name: "search"
            md_bg_color: [.17, .17, .17, .17]
            FloatLayout:
                orientation: "vertical"
                MDLabel:
                    text: "In construction"
                    font_style: "H6"
                    halign:"center"
                    pos_hint:{"center_x":.5, "center_y":.5}

        MDScreen:
            name: "parinfo"
            md_bg_color: [.17, .17, .17, .17]
            MDIconButton:
                halign:"center"
                icon:"chevron-left"
                icon_size: "30sp"
                pos_hint:{"center_x":.05, "center_y":.95}
                on_release:
                    screen_manager.current = "student"
            BoxLayout:
                orientation: 'vertical'
                padding: dp(35)
                spacing: dp(15)


                BoxLayout:
                    orientation: 'vertical'

                    MDLabel:
                        text: "Parent Name:"
                        font_style: "H6"
                    MDLabel:
                        id: parent_name

                MDSeparator:

                BoxLayout: # Contact Section
                    orientation: 'vertical'
                    MDLabel:
                        text: "Contact:"
                        font_style: "H6"
                    MDLabel:
                        id: contact
                MDSeparator:

                BoxLayout: # Child's Name Section
                    orientation: 'vertical'
                    MDLabel:
                        text: "Child's Name:"
                        font_style: "H6"
                    MDLabel:
                        id: child
                MDSeparator:

                BoxLayout: # Child's Age Section
                    orientation: 'vertical'
                    MDLabel:
                        text: "Child's Age:"
                        font_style: "H6"
                    MDLabel:
                        id: age

                Widget: # Spacer (optional)
                    size_hint_y: 1


        MDScreen:
            name: "visinfo"
            md_bg_color: [.17, .17, .17, .17]
            MDIconButton:
                halign:"center"
                icon:"chevron-left"
                icon_size: "30sp"
                pos_hint:{"center_x":.05, "center_y":.95}
                on_release:
                    screen_manager.current = "visitor"
            BoxLayout:
                orientation: 'vertical'
                padding: dp(35)
                spacing: dp(15)


                BoxLayout:  # School/Visitor Name
                    orientation: 'vertical'
                    MDLabel:
                        text: "School / Visitor Name:"
                        font_style: "H6"
                    MDLabel:
                        id:sname

                MDSeparator:

                BoxLayout:  # Head Visitor / Teacher Name
                    orientation: 'vertical'
                    MDLabel:
                        text: "Head of Visitor / Teacher Name:"
                        font_style: "H6"
                    MDLabel:
                        id: gui

                MDSeparator:

                BoxLayout:  # Contact
                    orientation: 'vertical'
                    MDLabel:
                        text: "Contact:"
                        font_style: "H6"
                    MDLabel:
                        id:no

                MDSeparator:

                BoxLayout:  # Number Visitor / Students
                    orientation: 'vertical'
                    MDLabel:
                        text: "Numbers of Visitors / Students:"
                        font_style: "H6"
                    MDLabel:
                        id:total

                MDSeparator:

                BoxLayout:  # Date of Visit
                    orientation: 'vertical'
                    MDLabel:
                        text: "Date of Visit:"
                        font_style: "H6"
                    MDLabel:
                        id: visit_date_label # Give it an id to update from Python
                        text: "2024/12/23"

                Widget:  # Spacer
                    size_hint_y: 1

        MDScreen:
            name: "share"
            md_bg_color: [.17, .17, .17, .17]
            FloatLayout:
                orientation:"vertical"
                MDLabel:
                    text:"Share report via whatsapp"
                    font_style:"H6"
                    halign:"center"
                    pos_hint: {"center_x": .5, "center_y": .95}

                MDLabel:
                    id: filename_label
                    halign:"center"
                    pos_hint: {"center_x": .5, "center_y": .7}

                MDIconButton:
                    icon: "whatsapp"
                    icon_size: "50sp"
                    pos_hint: {"center_x": .5, "center_y": .5}
                    on_release: app.share_whatsapp()


    AKBottomNavigation2:
        bg_color: app.theme_cls.bg_darkest

        NavigationButton:
            text: 'Home'
            icon: 'home'
            on_release:
                screen_manager.current = "home"
                app.update_graph()

        NavigationButton:
            text: 'Daily'
            icon: 'calendar'
            on_release: screen_manager.current = "daily"

        NavigationButton:
            text: 'Report'
            icon: 'file-chart'
            on_release: screen_manager.current = "report"


<NavigationButton@Button_Item>
    icon_color: app.theme_cls.text_color
    text_color: app.theme_cls.text_color
    button_bg_color: app.theme_cls.primary_color
    mode: 'color_on_active'
    badge_disabled: True

<MyAKBarChart@AKBarChart>
    size_hint_y: None
    height: dp(180)
#    x_values: [5, 8, 15]
#    y_values: [0, 0, 1]
    x_values: [1, 2, 3]
    y_values: [100, 8, 8]
    label_size: dp(12)

<InfoCard@MDBoxLayout>:
    md_bg_color: [.17, .17, .17, .3]
    radius: [15]
    name: ""
    orientation: 'horizontal'
    FloatLayout:
        MDLabel:
            halign:"left"
            text:root.name
            font_size: '16sp'
            pos_hint:{"center_x":.55, "center_y":.5}

        MDIconButton:
            halign:"center"
            icon:"chevron-right"
            icon_size: "30sp"
            pos_hint:{"center_x":.95, "center_y":.5}
            on_release:
                app.choice(root.name)

<StuCard@MDBoxLayout>:
    md_bg_color: [.17, .17, .17, .3]
    radius: [15]
    name: ""
    orientation: 'horizontal'
    FloatLayout:
        MDLabel:
            halign:"left"
            text:root.name
            font_size: '16sp'
            pos_hint:{"center_x":.55, "center_y":.5}
        MDIconButton:
            halign:"center"
            icon:"chevron-right"
            icon_size: "30sp"
            pos_hint:{"center_x":.95, "center_y":.5}
            on_release:
                app.student_choice(root.name, root.pname, root.pnumber, root.cage)

<StuCardx@MDBoxLayout>:
    md_bg_color: [.17, .17, .17, .3]
    radius: [15]
    name: ""
    orientation: 'horizontal'
    FloatLayout:
        MDLabel:
            halign:"left"
            text:root.name
            font_size: '16sp'
            pos_hint:{"center_x":.55, "center_y":.5}

<VisCard@MDBoxLayout>:
    md_bg_color: [.17, .17, .17, .3]
    radius: [15]
    name: ""
    orientation: 'horizontal'
    FloatLayout:
        MDLabel:
            halign:"left"
            text:root.name
            font_size: '16sp'
            pos_hint:{"center_x":.55, "center_y":.5}
        MDIconButton:
            halign:"center"
            icon:"chevron-right"
            icon_size: "30sp"
            pos_hint:{"center_x":.95, "center_y":.5}
            on_release:
                app.visitor_choice(root.name, root.gname, root.total, root.phone)

